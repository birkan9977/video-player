<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="Frame Player" />
    <meta name="author" content="Birkan Bilici" />
    <title>Video Player</title>
    <!--styles-->
    <link rel="stylesheet" type="text/css" href="style.css">

    <!--scripts-->
    <script src="frame-player.js"></script>
  </head>

  

  <body>
    <div id="player" class="player-container">
      <div class="interior-frame">
        <canvas
          id="player-canvas"
          width="640"
          height="360"
          onclick="handleTogglePlayPause()"
        >
        </canvas>
        <div id="progressbarFrame" onclick="handleJumpToFrame()">
          <div id="progressbar"></div>
        </div>
        <div class="buttons">
          <button
            id="play-button"
            onclick="handleTogglePlayPause()"
            onplay="handleEvent()"
          >
            Play
          </button>
          <button id="reset-button" onclick="handleResetParams()">
            Reset Params
          </button>
        </div>

        <form>
          <div class="controls">
            <label>GoTo Frame No</label>
            <input
              id="frame-number"
              type="number"
              onchange="handleGetFrame()"
              min="1"
              max="175"
              placeholder="Enter a frame number"
            />
          </div>
          <div class="controls">
            <label>Current Frame Number</label>
            <input type="text" id="display-frame-number" />
          </div>
          <div class="controls">
            <label>Milliseconds</label>
            <input type="text" id="display-milliseconds" />
          </div>
          <div class="controls">
            <label>FPS</label>
            <input
              type="text"
              id="display-fps"
              value="10"
              onchange="handleFPS()"
            />
          </div>
        </form>
      </div>
    </div>

    <script>
      let player = new FramePlayer("player");
      //defaults values
      const handleResetParams = () => {
        document.getElementById("frame-number").value = 1;
        document.getElementById("display-fps").value = 10;
        player.resetValues();
      };

      handleResetParams();

      player.on("downloadcomplete", (e) => {
        console.log("download completed in " + e.detail.ms + " ms");
        //console.log(e);
      });

      player.on("pause", (e) => {
        console.log("video is paused at " + e.detail.ms + " ms");
        //console.log(e)
      });

      player.on("play", (e) => {
        console.log("video is playing now at " + e.detail.ms + " ms");
        //console.log(e)
      });

      player.on("end", (e) => {
        console.log("video is completed");
        //console.log(e)
      });

      const handleTogglePlayPause = () => {
        if (player.playerPlaying()) {
          player.pause();
          document.getElementById("play-button").innerHTML = "Play";
        } else {
          player.play();
          document.getElementById("play-button").innerHTML = "Pause";
        }
        //console.log("playing", player.playerPlaying());
      };

      const handleGetFrame = () => {
        let element = document.getElementById("frame-number");
        let frameNumber = element.value;
        if (
          frameNumber < 1 ||
          frameNumber > 175 ||
          !Number.isInteger(frameNumber)
        ) {
          element.value = 1;
          return;
        }
        player.frameNumber = frameNumber;
        player.displayFrame(frameNumber);
        //console.log("getFrameNumber :" + frameNumber);
      };

      const handleJumpToFrame = () => {
        const rect = event.target.getBoundingClientRect();
        const x = event.clientX - rect.left; //x position within the element.
        //console.log("Left: " + x);
        player.jumpToFrame(x);
      };

      const handleFPS = () => {
        const element = document.getElementById("display-fps");
        player.fps = element.value;
        console.log(player.fps);
      };

      const handleEvent = () => {
        console.log("onplay");
      };
    </script>
  </body>
</html>
